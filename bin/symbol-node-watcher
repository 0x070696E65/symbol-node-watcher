#!/usr/bin/env node

import cron from 'node-cron'
import { nodeWatch } from '../src/nodeWatch'
import { loadConfig } from '../src/config'

const config = loadConfig()
const REPEAT_SECONDS = config.repeatSeconds

let task

const args = process.argv.slice(2)

if (args[0] === 'start') {
  startTask()
} else if (args[0] === 'stop') {
  stopTask()
} else {
  console.error('Unknown command')
}

function startTask() {
  const cronExpression = `*/${REPEAT_SECONDS} * * * * *`
  task = cron.schedule(cronExpression, () => {
    nodeWatch()
  })
  task.start()
  console.log('Task started.')
}

function stopTask() {
  if (task) {
    task.stop()
    console.log('Task stopped.')
  } else {
    console.log('Task is not running.')
  }
}
